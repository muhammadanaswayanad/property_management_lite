<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Invoice Report Action -->
    <record id="action_report_property_invoice" model="ir.actions.report">
        <field name="name">Property Invoice</field>
        <field name="model">property.invoice</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">property_management_lite.report_property_invoice</field>
        <field name="report_file">property_management_lite.report_property_invoice</field>
        <field name="binding_model_id" ref="model_property_invoice"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Invoice Report Template -->
    <template id="report_property_invoice">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <!-- Custom Styles -->
                        <style>
                            .invoice-header { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
                            .invoice-title { font-size: 2.5rem; font-weight: bold; color: #2c3e50; }
                            .invoice-number { font-size: 1.5rem; color: #3498db; }
                            .company-info { background-color: #3498db; color: white; padding: 15px; border-radius: 5px; }
                            .client-info { background-color: #ecf0f1; padding: 15px; border-radius: 5px; }
                            .invoice-table th { background-color: #34495e; color: white; padding: 12px; }
                            .invoice-table td { padding: 10px; border-bottom: 1px solid #ecf0f1; }
                            .total-section { background-color: #f8f9fa; padding: 20px; border-radius: 8px; }
                            .amount-due { color: #e74c3c; font-weight: bold; font-size: 1.2rem; }
                            .paid-amount { color: #27ae60; font-weight: bold; }
                        </style>

                        <!-- Invoice Header -->
                        <div class="invoice-header row">
                            <div class="col-8">
                                <h1 class="invoice-title">
                                    <i class="fa fa-file-text-o"/>
                                    <span t-if="o.state == 'draft'">Draft Invoice</span>
                                    <span t-else="">INVOICE</span>
                                </h1>
                                <p class="text-muted mb-0">Property Rental Invoice</p>
                            </div>
                            <div class="col-4 text-right">
                                <h2 class="invoice-number mt-0" t-field="o.name"/>
                                <p class="mb-0">
                                    <strong>Date:</strong> <span t-field="o.date" t-options="{'widget': 'date'}"/>
                                </p>
                                <p class="mb-0">
                                    <strong>Due:</strong> <span t-field="o.due_date" t-options="{'widget': 'date'}" 
                                           t-attf-class="#{(o.due_date and o.due_date &lt; datetime.date.today() and o.state != 'paid') and 'text-danger font-weight-bold' or ''}"/>
                                </p>
                            </div>
                        </div>

                        <!-- Party Information -->
                        <div class="row mb-4">
                            <div class="col-6">
                                <div class="company-info">
                                    <h4 class="mb-3"><i class="fa fa-building"/> From:</h4>
                                    <strong t-field="o.company_id.name"/>
                                    <div t-field="o.company_id.partner_id" 
                                         t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': True}"/>
                                    <div t-if="o.company_id.phone">
                                        <i class="fa fa-phone"/> <span t-field="o.company_id.phone"/>
                                    </div>
                                    <div t-if="o.company_id.email">
                                        <i class="fa fa-envelope"/> <span t-field="o.company_id.email"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="client-info">
                                    <h4 class="mb-3"><i class="fa fa-user"/> Bill To:</h4>
                                    <strong t-field="o.tenant_id.name"/>
                                    <div t-if="o.tenant_id.phone">
                                        <i class="fa fa-phone"/> <span t-field="o.tenant_id.phone"/>
                                    </div>
                                    <div t-if="o.tenant_id.email">
                                        <i class="fa fa-envelope"/> <span t-field="o.tenant_id.email"/>
                                    </div>
                                    <div t-if="o.tenant_id.id_passport">
                                        <i class="fa fa-id-card-o"/> ID: <span t-field="o.tenant_id.id_passport"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Property Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <div class="row">
                                        <div class="col-4">
                                            <strong><i class="fa fa-building"/> Property:</strong><br/>
                                            <span t-field="o.property_id.name"/>
                                        </div>
                                        <div class="col-4">
                                            <strong><i class="fa fa-bed"/> Room:</strong><br/>
                                            <span t-field="o.room_id.name"/>
                                        </div>
                                        <div class="col-4" t-if="o.period_from and o.period_to">
                                            <strong><i class="fa fa-calendar"/> Period:</strong><br/>
                                            <span t-field="o.period_from" t-options="{'widget': 'date'}"/> - <span t-field="o.period_to" t-options="{'widget': 'date'}"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Invoice Items Table -->
                        <div class="row">
                            <div class="col-12">
                                <table class="table table-condensed invoice-table" style="border: 1px solid #dee2e6;">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%;">Description</th>
                                            <th class="text-right" style="width: 15%;">Qty</th>
                                            <th class="text-right" style="width: 15%;">Unit Price</th>
                                            <th class="text-right" style="width: 20%;">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div style="font-weight: bold; color: #2c3e50;">
                                                    Monthly Rent - <span t-field="o.room_id.name"/>
                                                </div>
                                                <div class="text-muted small">
                                                    <i class="fa fa-building"/> <span t-field="o.property_id.name"/>
                                                </div>
                                                <div class="text-muted small" t-if="o.period_from and o.period_to">
                                                    <i class="fa fa-calendar"/> Period: <span t-field="o.period_from" t-options="{'widget': 'date'}"/> - <span t-field="o.period_to" t-options="{'widget': 'date'}"/>
                                                </div>
                                            </td>
                                            <td class="text-right">1.0</td>
                                            <td class="text-right">
                                                <span t-field="o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                            <td class="text-right" style="font-weight: bold;">
                                                <span t-field="o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Totals Section -->
                        <div class="row">
                            <div class="col-7">
                                <!-- Payment History -->
                                <div t-if="o.payment_ids" class="mt-4">
                                    <h4><i class="fa fa-credit-card"/> Payment History</h4>
                                    <table class="table table-sm table-bordered">
                                        <thead style="background-color: #27ae60; color: white;">
                                            <tr>
                                                <th>Date</th>
                                                <th>Amount</th>
                                                <th>Method</th>
                                                <th>Reference</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-foreach="o.payment_ids" t-as="payment">
                                                <td><span t-field="payment.date" t-options="{'widget': 'date'}"/></td>
                                                <td class="paid-amount">
                                                    <span t-field="payment.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                </td>
                                                <td><span t-field="payment.payment_method"/></td>
                                                <td><span t-field="payment.reference"/></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-5">
                                <div class="total-section">
                                    <table class="table table-sm" style="margin-bottom: 0;">
                                        <tr style="border-bottom: 2px solid #34495e;">
                                            <td style="font-size: 1.1rem; font-weight: bold;">
                                                <i class="fa fa-calculator"/> Subtotal:
                                            </td>
                                            <td class="text-right" style="font-size: 1.1rem; font-weight: bold;">
                                                <span t-field="o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold; color: #27ae60;">
                                                <i class="fa fa-check-circle"/> Total Paid:
                                            </td>
                                            <td class="text-right paid-amount">
                                                <span t-field="o.paid_amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                        <tr style="border-top: 3px solid #e74c3c;">
                                            <td class="amount-due" style="font-size: 1.3rem;">
                                                <i class="fa fa-exclamation-circle"/> Amount Due:
                                            </td>
                                            <td class="text-right amount-due" style="font-size: 1.3rem;">
                                                <span t-field="o.amount_due" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <!-- Status Badge -->
                                <div class="text-center mt-3">
                                    <span t-if="o.state == 'draft'" class="badge badge-secondary badge-pill" style="font-size: 1rem; padding: 8px 16px;">
                                        <i class="fa fa-edit"/> DRAFT
                                    </span>
                                    <span t-elif="o.state == 'open'" class="badge badge-warning badge-pill" style="font-size: 1rem; padding: 8px 16px;">
                                        <i class="fa fa-clock-o"/> PENDING PAYMENT
                                    </span>
                                    <span t-elif="o.state == 'paid'" class="badge badge-success badge-pill" style="font-size: 1rem; padding: 8px 16px;">
                                        <i class="fa fa-check"/> PAID IN FULL
                                    </span>
                                    <span t-elif="o.state == 'overdue'" class="badge badge-danger badge-pill" style="font-size: 1rem; padding: 8px 16px;">
                                        <i class="fa fa-exclamation-triangle"/> OVERDUE
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Notes -->
                        <div class="row mt-5">
                            <div class="col-12">
                                <div class="border-top pt-4">
                                    <div class="row">
                                        <div class="col-6">
                                            <h5><i class="fa fa-info-circle"/> Payment Information</h5>
                                            <div class="small text-muted">
                                                <p><strong>Payment Due Date:</strong> <span t-field="o.due_date" t-options="{'widget': 'date'}"/></p>
                                                <p><strong>Late Payment:</strong> Late fees may apply after the due date.</p>
                                                <p><strong>Payment Methods:</strong> Cash, Bank Transfer, Check</p>
                                                <p t-if="o.company_id.bank_ids">
                                                    <strong>Bank Details:</strong><br/>
                                                    <span t-foreach="o.company_id.bank_ids[:1]" t-as="bank">
                                                        Bank: <span t-field="bank.bank_name"/><br/>
                                                        Account: <span t-field="bank.acc_number"/>
                                                    </span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <h5><i class="fa fa-file-text"/> Terms &amp; Conditions</h5>
                                            <div class="small text-muted">
                                                <ul style="padding-left: 20px; margin: 0;">
                                                    <li>Payment is due by the specified due date</li>
                                                    <li>Late payments may incur additional fees</li>
                                                    <li>Please retain this invoice for your records</li>
                                                    <li>Contact us immediately for any billing questions</li>
                                                    <li>This invoice is computer generated and valid without signature</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="row mt-4">
                            <div class="col-12 text-center">
                                <div style="border-top: 2px solid #3498db; padding-top: 15px;">
                                    <p class="text-muted small mb-1">
                                        <strong>Thank you for choosing our property services!</strong>
                                    </p>
                                    <p class="text-muted small mb-0">
                                        For questions about this invoice, contact us at 
                                        <span t-field="o.company_id.phone"/> or 
                                        <span t-field="o.company_id.email"/>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="oe_structure"/>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Receipt Report for Payments -->
    <record id="action_report_property_receipt" model="ir.actions.report">
        <field name="name">Payment Receipt</field>
        <field name="model">property.payment</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">property_management_lite.report_property_receipt</field>
        <field name="report_file">property_management_lite.report_property_receipt</field>
        <field name="binding_model_id" ref="model_property_payment"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Receipt Template -->
    <template id="report_property_receipt">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <!-- Custom Styles for Receipt -->
                        <style>
                            .receipt-header { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 25px; border-radius: 10px; margin-bottom: 30px; }
                            .receipt-title { font-size: 2.5rem; font-weight: bold; }
                            .receipt-number { font-size: 1.3rem; opacity: 0.9; }
                            .receipt-info { background-color: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 5px solid #27ae60; }
                            .amount-box { background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 20px; border-radius: 10px; text-align: center; }
                            .amount-received { font-size: 2rem; font-weight: bold; }
                            .signature-box { border: 2px dashed #bdc3c7; padding: 30px; margin-top: 20px; text-align: center; background-color: #f8f9fa; }
                        </style>

                        <!-- Receipt Header -->
                        <div class="receipt-header text-center">
                            <h1 class="receipt-title mb-2">
                                <i class="fa fa-receipt"/>
                                PAYMENT RECEIPT
                            </h1>
                            <p class="receipt-number mb-0">Receipt No: <span t-field="o.name"/></p>
                        </div>

                        <!-- Receipt Info -->
                        <div class="row mb-4">
                            <div class="col-8">
                                <div class="receipt-info">
                                    <h4 class="mb-3"><i class="fa fa-user"/> Received From:</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <p class="mb-1"><strong>Name:</strong> <span t-field="o.tenant_id.name"/></p>
                                            <p class="mb-1" t-if="o.tenant_id.phone"><strong>Phone:</strong> <span t-field="o.tenant_id.phone"/></p>
                                            <p class="mb-1" t-if="o.tenant_id.email"><strong>Email:</strong> <span t-field="o.tenant_id.email"/></p>
                                        </div>
                                        <div class="col-6">
                                            <p class="mb-1" t-if="o.tenant_id.id_passport"><strong>ID:</strong> <span t-field="o.tenant_id.id_passport"/></p>
                                            <p class="mb-1"><strong>Property:</strong> <span t-field="o.property_id.name"/></p>
                                            <p class="mb-1"><strong>Room:</strong> <span t-field="o.room_id.name"/></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="amount-box">
                                    <h5 class="mb-2"><i class="fa fa-money"/> Amount Received</h5>
                                    <div class="amount-received">
                                        <span t-field="o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Details -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <table class="table table-bordered">
                                    <tbody>
                                        <tr>
                                            <td class="font-weight-bold" style="background-color: #ecf0f1; width: 25%;"><i class="fa fa-calendar"/> Payment Date:</td>
                                            <td><span t-field="o.date" t-options="{'widget': 'date'}"/></td>
                                            <td class="font-weight-bold" style="background-color: #ecf0f1; width: 25%;"><i class="fa fa-credit-card"/> Payment Method:</td>
                                            <td><span t-field="o.payment_method"/></td>
                                        </tr>
                                        <tr>
                                            <td class="font-weight-bold" style="background-color: #ecf0f1;"><i class="fa fa-hashtag"/> Reference:</td>
                                            <td><span t-field="o.reference"/></td>
                                            <td class="font-weight-bold" style="background-color: #ecf0f1;"><i class="fa fa-file-text"/> For Invoice:</td>
                                            <td><span t-field="o.invoice_id.name"/></td>
                                        </tr>
                                        <tr t-if="o.notes">
                                            <td class="font-weight-bold" style="background-color: #ecf0f1;"><i class="fa fa-sticky-note"/> Notes:</td>
                                            <td colspan="3"><span t-field="o.notes"/></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Invoice Summary -->
                        <div class="row mb-4" t-if="o.invoice_id">
                            <div class="col-12">
                                <h4><i class="fa fa-list"/> Invoice Summary</h4>
                                <table class="table table-sm table-bordered">
                                    <thead style="background-color: #34495e; color: white;">
                                        <tr>
                                            <th>Invoice Total</th>
                                            <th>Previous Payments</th>
                                            <th>This Payment</th>
                                            <th>Remaining Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center">
                                                <span t-field="o.invoice_id.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                            <td class="text-center">
                                                <span t-esc="o.invoice_id.paid_amount - o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                            <td class="text-center font-weight-bold" style="background-color: #d5f4e6;">
                                                <span t-field="o.amount" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                            <td class="text-center">
                                                <span t-field="o.invoice_id.amount_due" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Signature Section -->
                        <div class="row mt-5">
                            <div class="col-6">
                                <div class="signature-box">
                                    <p class="mb-4"><strong>Received By (Signature)</strong></p>
                                    <div style="height: 50px; border-bottom: 1px solid #000; margin-bottom: 10px;"></div>
                                    <p class="small text-muted mb-0">Authorized Representative</p>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="signature-box">
                                    <p class="mb-4"><strong>Tenant Acknowledgment</strong></p>
                                    <div style="height: 50px; border-bottom: 1px solid #000; margin-bottom: 10px;"></div>
                                    <p class="small text-muted mb-0">Tenant Signature</p>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="row mt-4">
                            <div class="col-12 text-center">
                                <div style="border-top: 2px solid #27ae60; padding-top: 15px;">
                                    <p class="text-muted small mb-1">
                                        <strong>Thank you for your payment!</strong>
                                    </p>
                                    <p class="text-muted small mb-0">
                                        This is a computer-generated receipt and is valid without signature.
                                        For queries, contact us at <span t-field="o.company_id.phone"/>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="oe_structure"/>
                    </div>
                </t>
            </t>
        </t>
    </template>

</odoo>
